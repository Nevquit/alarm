<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ùìêùìµùì™ùìªùì∂ ùìõùì≤ùìºùìΩ</title>
  <style>
    /* Style the page */
    body {
      background-image: url('index.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      font-family: 'Open Sans', sans-serif;
      text-align: center;
    }

    /* Style the table */
    table {
      width: 80%;
      margin: 50px auto 20px;
      border-collapse: collapse;
      background-color: rgba(255, 255, 255, 0.7);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    th, td {
      padding: 10px;
      text-align: left;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      width: 30%;
      cursor: pointer;
    }
    .ascending:after {
      content: " ‚ñ≤";
    }
    .descending:after {
      content: " ‚ñº";
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    a {
      color: blue;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    
    .status {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .status-ok {
      background-color: #4CAF50;
    }
    .status-alert {
      background-color: #F44336;
    }
    /* Hide the "Alert" and "OK" text */
    .status-alert, .status-ok {
      text-indent: -9999px;
    }
    
    /* Style the search and filter */
    .search-filter {
      text-align: right;
      margin-bottom: 20px;
      margin-right: 20px;
    }
    #searchInput {
      padding: 5px;
      border-radius: 5px;
      border: none;
      margin-right: 10px;
    }
    #statusFilter {
      padding: 5px;
      border-radius: 5px;
      border: none;
    }
    #statusFilter option {
      background-color: #f2f2f2;
    }
    
    /* Style the h1 title */
    h1 {
      font-family: 'Brush Script MT', cursive;
      font-size: 50px;
      margin-top: 20px;
    }
    
    /* Style the table background with a frosted glass effect */
    .table-container {
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    
  </style>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Brush+Script+MT&display=swap" rel="stylesheet">
</head>
<body>
  <div class="search-filter">
    <input type="text" id="searchInput" onkeyup="search()" placeholder="Search for alarms...">
    <select id="statusFilter" onchange="filterByStatus()">
      <option value="all">All</option>
      <option value="alert">Alert</option>
      <option value="ok">OK</option>
    </select>
  </div>
  <div class="table-container">
    <h1>ùìêùìµùì™ùìªùì∂ ùìõùì≤ùìºùìΩ</h1>
    <table id="alarmTable">
      <thead>
        <tr>
          <th data-column="name">Alarm Name</th>
          <th data-column="status">Status</th>
          <th data-column="details">Details</th>
          <th data-column="history">History</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <script>
    // Load the JSON file
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var alarms = JSON.parse(this.responseText);
        var tableBody = document.querySelector("#alarmTable tbody");
        
        // Populate the table with data from the JSON file
        for (var i = 0; i < alarms.length; i++) {
          var alarm = alarms[i];
          var row = tableBody.insertRow(-1);
          var nameCell = row.insertCell(0);
          var statusCell = row.insertCell(1);
          var detailsCell = row.insertCell(2);
          var historyCell = row.insertCell(3);
          
          nameCell.innerHTML = alarm.name;
          statusCell.innerHTML = "<div class='status status-" + alarm.status.toLowerCase() + "'>" + alarm.status + "</div>";
          detailsCell.innerHTML = "<a href='" + alarm.detailsLink + "' target='_blank'>View Details</a>";
          historyCell.innerHTML = "<a href='" + alarm.historyLink + "' target='_blank'>View History</a>";
        }
        
        // Make the table sortable by clicking on the column headers
        var headers = document.querySelectorAll("#alarmTable th");
        headers.forEach(function(header) {
          header.addEventListener("click", function() {
            var column = this.getAttribute("data-column");
            var direction = this.getAttribute("data-direction");
            var rows = Array.from(tableBody.querySelectorAll("tr"));
            
            // Sort the rows based on the column clicked and the sort direction
            rows.sort(function(a, b) {
              var aText = a.querySelector("td:nth-child(" + (headers.indexOf(header) + 1) + ")").textContent;
              var bText = b.querySelector("td:nth-child(" + (headers.indexOf(header) + 1) + ")").textContent;
              
              if (column == "status") {
                aText = a.querySelector(".status").classList.contains("status-ok") ? "ok" : "alert";
                bText = b.querySelector(".status").classList.contains("status-ok") ? "ok" : "alert";
              }
              
              if (direction == "ascending") {
                return aText.localeCompare(bText);
              } else {
                return bText.localeCompare(aText);
              }
            });
            
            // Remove the existing rows and add the sorted rows back to the table
            tableBody.innerHTML = "";
            rows.forEach(function(row) {
              tableBody.appendChild(row);
            });
            
            // Update the sort direction indicator
            headers.forEach(function(header) {
              header.removeAttribute("data-direction");
              header.classList.remove("ascending", "descending");
            });
            this.setAttribute("data-direction", direction == "ascending" ? "descending" : "ascending");
            this.classList.toggle("ascending", direction == "ascending");
            this.classList.toggle("descending", direction == "descending");
          });
        });
      }
      
      // Filter the table by status
      filterByStatus = function() {
        var selectedStatus = document.querySelector("#statusFilter").value;
        var rows = Array.from(tableBody.querySelectorAll("tr"));
        
        rows.forEach(function(row) {
          var status = row.querySelector(".status").classList.contains("status-ok") ? "ok" : "alert";
          if (selectedStatus == "all" || status == selectedStatus) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      };
      
      // Search the table for alarms
      search = function() {
        var searchTerm = document.querySelector("#searchInput").value.toLowerCase();
        var rows = Array.from(tableBody.querySelectorAll("tr"));
        
        rows.forEach(function(row) {
          var name = row.querySelector("td:nth-child(1)").textContent.toLowerCase();
          if (name.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      };
      
      // Call the filterByStatus function initially to show all alarms
      filterByStatus();
      
    };
    xhr.open("GET", "alarms.json", true);
    xhr.send();
  </script>
</body>
</html>
