<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>𝓐𝓵𝓪𝓻𝓶 𝓛𝓲𝓼𝓽</title>
  <style>
    /* Style the page */
    body {
      background-image: url('index.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      font-family: 'Open Sans', sans-serif;
      text-align: center;
    }

    /* Style the table */
    table {
      width: 80%;
      margin: 0 auto;
      border-collapse: collapse;
      margin-bottom: 20px;
      background-color: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(5px);
      border-radius: 10px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      width: 30%;
      cursor: pointer;
    }
    .ascending:after {
      content: " ▲";
    }
    .descending:after {
      content: " ▼";
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    a {
      color: blue;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    
    .status {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .status-ok {
      background-color: #4CAF50;
    }
    .status-alert {
      background-color: #F44336;
    }
    /* Hide the "Alert" and "OK" text */
    .status-alert, .status-ok {
      text-indent: -9999px;
    }
    
    /* Add styles for search and filter fields */
    .search-filter {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 15px;
    }
    #searchInput, #statusFilter {
      padding: 6px;
      margin-left: 10px;
      border-radius: 5px;
      border: none;
      background-color: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(5px);
      font-family: 'Open Sans', sans-serif;
    }
    #searchInput:focus, #statusFilter:focus {
      outline: none;
      box-shadow: 0 0 5px 0px #bbb;
    }
    
  </style>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>
  <h1 style="font-family: 'Brush Script MT', cursive;">𝓐𝓵𝓪𝓻𝓶 𝓛𝓲𝓼𝓽</h1>
  <div class="search-filter">
    <input type="text" id="searchInput" onkeyup="search()" placeholder="Search for alarms...">
    <select id="statusFilter" onchange="filterByStatus()">
      <option value="all">All</option>
      <option value="alert">Alert</option>
      <option value="ok">OK</option>
    </select>
  </div>
  <table id="alarmTable">
    <thead>
      <tr>
        <th data-column="name">Alarm Name</th>
        <th data-column="status">Status</th>
        <th data-column="details">Details</th>
        <th data-column="history">History</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
  <script>
    // Load the JSON file
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var json = JSON.parse(this.responseText);
        var table = document.getElementById("alarmTable");
        var tbody = table.getElementsByTagName("tbody")[0];

        // Loop through each alarm and add a row to the table
        for (var key in json) {
          var row = tbody.insertRow(-1);
          var nameCell = row.insertCell(0);
          var statusCell = row.insertCell(1);
          var detailsCell = row.insertCell(2);
          var historyCell = row.insertCell(3);

          nameCell.innerHTML = json[key].name;
          statusCell.innerHTML = '<div class="status ' + json[key].status.toLowerCase() + '">' + json[key].status + '</div>';
          detailsCell.innerHTML = '<a href="' + json[key].detailsLink + '">View Details</a>';
          historyCell.innerHTML = '<a href="' + json[key].historyLink + '">View History</a>';
        }
      }
    };
    xhr.open("GET", "alarms.json", true);
    xhr.send();

    // Add sorting functionality to the table
    var table = document.getElementById("alarmTable");
    var headers = table.getElementsByTagName("th");
    for (var i = 0; i < headers.length; i++) {
      headers[i].addEventListener("click", function() {
        var column = this.getAttribute("data-column");
        var rows = Array.from(table.getElementsByTagName("tr")).slice(1); // exclude the header row
        var isAscending = this.classList.toggle("ascending");
        rows.sort(function(row1, row2) {
          var cell1 = row1.getElementsByTagName("td")[getColumnIndex(column)];
          var cell2 = row2.getElementsByTagName("td")[getColumnIndex(column)];
          return compareCells(cell1, cell2);
        });
        if (!isAscending) {
          rows.reverse();
          this.classList.add("descending");
        } else {
          this.classList.remove("descending");
        }
        for (var j = 0; j < rows.length; j++) {
          table.appendChild(rows[j]);
        }
      });
    }

    function getColumnIndex(columnName) {
      var headers = table.getElementsByTagName("th");
      for (var i = 0; i < headers.length; i++) {
        if (headers[i].getAttribute("data-column") == columnName) {
          return i;
        }
      }
      return -1;
    }

    function compareCells(cell1, cell2) {
      var text1 = cell1.textContent.trim();
      var text2 = cell2.textContent.trim();
      if (text1 == text2) {
        return 0;
      }
      if (!isNaN(text1) && !isNaN(text2)) {
        return parseFloat(text1) - parseFloat(text2);
      }
      return text1.localeCompare(text2);
    }

    // Add search functionality to the table
    function search() {
      var input = document.getElementById("searchInput");
      var filter = input.value.toUpperCase();
      var rows = table.getElementsByTagName("tr");
      for (var i = 1; i < rows.length; i++) { // exclude the header row
        var nameCell = rows[i].getElementsByTagName("td")[0];
        if (nameCell) {
          var nameText = nameCell.textContent.toUpperCase();
          if (nameText.indexOf(filter) > -1) {
            rows[i].style.display = "";
          } else {
            rows[i].style.display = "none";
          }
        }
      }
    }

    // Add filter functionality to the table
    function filterByStatus() {
      var select = document.getElementById("statusFilter");
      var filter = select.value.toLowerCase();
      var rows = table.getElementsByTagName("tr");
      for (var i = 1; i < rows.length; i++) { // exclude the header row
        var statusCell = rows[i].getElementsByTagName("td")[1];
        if (statusCell) {
          var statusText = statusCell.textContent.toLowerCase();
          if (filter == "all" || statusText.indexOf(filter) > -1) {
            rows[i].style.display = "";
          } else {
            rows[i].style.display = "none";
          }
        }
      }
    }
  </script>
</body>
</html>
