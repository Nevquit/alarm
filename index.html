<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Alarm List</title>
  <style>
    /* Style the table */
    table {
            width: 80%;
            border-collapse: collapse;
            margin: auto;
            font-family: 'Open Sans', sans-serif;
          }
    th, td {
      padding: 10px;
      text-align: left;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      width: 30%;
      cursor: pointer;
    }
    .ascending:after {
      content: " ▲";
    }
    .descending:after {
      content: " ▼";
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    a {
      color: blue;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    body {
      background-image: url('index.jpg');
      background-size: cover;
      background-repeat: no-repeat;
    }
    
    .status {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .status-ok {
      background-color: #4CAF50;
    }
    .status-alert {
      background-color: #F44336;
    }
    /* Hide the "Alert" and "OK" text */
    .status-alert, .status-ok {
      text-indent: -9999px;
    }
    #searchBox {
      position: absolute;
      top: 0;
      right: 0;
      margin: 20px;
    }

    #searchInput {
      width: 200px;
      padding: 5px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    #filterBox {
      position: absolute;
      top: 0;
      right: 0;
      margin: 20px;
    }

    #statusFilter {
      padding: 5px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
        
  </style>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>
  <h1>Alarm List</h1>
  <div id="searchBox">
    <input type="text" id="searchInput" onkeyup="search()" placeholder="Search for alarms...">
  </div>
  <table id="alarmTable">
    
    <thead>
      <tr>
        <th data-column="name">Alarm Name</th>
        <th data-column="status">Status
          <select id="statusFilter" onchange="filterByStatus()">
            <option value="all">All</option>
            <option value="ok">OK</option>
            <option value="alert">Alert</option>
          </select>
        </th>
        <th data-column="details">Details</th>
        <th data-column="history">History</th>
      </tr>
    </thead>

    <tbody>
    </tbody>
  </table>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Load the JSON file
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var json = JSON.parse(this.responseText);
          var table = document.getElementById("alarmTable");
          var tbody = table.getElementsByTagName("tbody")[0];

          // Loop through each alarm and add a row to the table
          for (var key in json) {
            if (json.hasOwnProperty(key)) {
              var obj = json[key];
              var row = tbody.insertRow(-1);
              row.insertCell(0).innerHTML = obj.name;
              var statusCell = row.insertCell(1);
              statusCell.innerHTML = obj.status;
              statusCell.classList.add("status");
              if (obj.status.toLowerCase() == "ok") {
                statusCell.classList.add("status-ok");
              } else {
                statusCell.classList.add("status-alert");
              }
              row.insertCell(2).innerHTML = obj.details;
              var historyCell = row.insertCell(3);
              var historyLink = document.createElement("a");
              historyLink.href = obj.history;
              historyLink.innerHTML = "View history";
              historyCell.appendChild(historyLink);
            }
          }
        }
      };
      xhr.open("GET", "alarms.json", true);
      xhr.send();
    });

    // Sort the table by column when the header is clicked
    var sortColumn = "";
    var sortOrder = "";
    function sortTable(column) {
      var table = document.getElementById("alarmTable");
      var tbody = table.getElementsByTagName("tbody")[0];
      var rows = tbody.getElementsByTagName("tr");
      var arr = [];
      var i, j, x, y;
      for (i = 0; i < rows.length; i++) {
        x = rows[i].getElementsByTagName("td")[column];
        y = x.textContent || x.innerText;
        arr.push([y, rows[i]]);
      }
      if (sortColumn == column && sortOrder == "ascending") {
        arr.sort(function(a, b) {
          return a[0] < b[0] ? 1 : -1;
        });
        sortOrder = "descending";
      } else {
        arr.sort(function(a, b) {
          return a[0] > b[0] ? 1 : -1;
        });
        sortOrder = "ascending";
      }
      for (i = 0; i < arr.length; i++) {
        tbody.appendChild(arr[i][1]);
      }
      // Remove the arrow icons from all header cells
      var headers = table.getElementsByTagName("th");
      for (i = 0; i < headers.length; i++) {
        headers[i].classList.remove("ascending");
        headers[i].classList.remove("descending");
      }
      // Add the arrow icon to the clicked header cell
      var arrow = sortOrder == "ascending" ? " ▲" : " ▼";
      headers[column].classList.add(sortOrder == "ascending" ? "ascending" : "descending");
      headers[column].innerHTML = headers[column].textContent + arrow;
      sortColumn = column;
    }

    // Filter the table by status
    function filterByStatus() {
      var statusFilter = document.getElementById("statusFilter");
      var status = statusFilter.options[statusFilter.selectedIndex].value;
      var table = document.getElementById("alarmTable");
      var tbody = table.getElementsByTagName("tbody")[0];
      var rows = tbody.getElementsByTagName("tr");
      for (var i = 0; i < rows.length; i++) {
        var statusCell = rows[i].getElementsByTagName("td")[1];
        if (status == "all" || statusCell.textContent.toLowerCase() == status) {
          rows[i].style.display = "";
        } else {
          rows[i].style.display = "none";
        }
      }
    }

    // Search the table
    function search() {
      var input = document.getElementById("searchInput");
      var filter = input.value.toLowerCase();
      var table = document.getElementById("alarmTable");
      var tbody = table.getElementsByTagName("tbody")[0];
      var rows = tbody.getElementsByTagName("tr");
      for (var i = 0; i < rows.length; i++) {
        var nameCell = rows[i].getElementsByTagName("td")[0];
        var detailsCell = rows[i].getElementsByTagName("td")[2];
        if (nameCell.textContent.toLowerCase().indexOf(filter) > -1 || detailsCell.textContent.toLowerCase().indexOf(filter) > -1) {
          rows[i].style.display = "";
        } else {
          rows[i].style.display = "none";
        }
      }
    }
  </script>
</body>
</html>
