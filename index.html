<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Monitoring Status</title>
    <style>
      /* CSS styles */
    </style>
  </head>
  <body>
    <h1>Monitoring Status</h1>
    <input type="text" id="search-bar" placeholder="Search alarms...">
    <table>
      <tr>
        <th>Monitor Name</th>
        <th>Status</th>
        <th>Details</th>
        <th>History</th>
      </tr>
      <tbody id="monitor-table"></tbody>
    </table>
    <script>
      // Create the callback function
      function handleData(data) {
        // Generate the table content dynamically
        function generateTable(data) {
          const monitorTable = document.getElementById("monitor-table");
          monitorTable.innerHTML = ""; // Clear the table before generating new content
          for (const monitor in data) {
            const status = data[monitor]["Status"];
            const details = data[monitor]["Details"];
            const history = data[monitor]["History"];

            // Process the name to capitalize the first letter of each word and remove underscores
            const name = monitor.replace(/_/g, " ").replace(/\b\w/g, l => l.toUpperCase());

            const row = document.createElement("tr");
            const nameCell = document.createElement("td");
            nameCell.textContent = name;
            const statusCell = document.createElement("td");
            statusCell.textContent = status;
            statusCell.classList.add(getStatusClass(status));
            const detailsCell = document.createElement("td");
            const detailsLink = document.createElement("a");
            detailsLink.href = details;
            detailsLink.textContent = "Details";
            detailsCell.appendChild(detailsLink);
            const historyCell = document.createElement("td");
            const historyLink = document.createElement("a");
            historyLink.href = history;
            historyLink.textContent = "History";
            historyCell.appendChild(historyLink);

            row.appendChild(nameCell);
            row.appendChild(statusCell);
            row.appendChild(detailsCell);
            row.appendChild(historyCell);

            monitorTable.appendChild(row);
          }
        }

        generateTable(data);
      }

      // Create the JSONP request
      function loadJSONP() {
        const script = document.createElement("script");
        script.src = "https://raw.githubusercontent.com/Nevquit/onemonitor_data/main/alarms.json?callback=handleData";
        document.head.appendChild(script);
      }

      // Load the JSONP data
      loadJSONP();

      // Get the CSS class name to display the status
      function getStatusClass(status) {
        if (status === "OK") {
          return "status-ok";
        } else if (status === "Alert") {
          return "status-alert";
        } else {
          return "status-error";
        }
      }

      // Get the search bar element
      const searchBar = document.getElementById("search-bar");

      // Listen for input event on the search bar
      searchBar.addEventListener("input", function() {
        const searchTerm = searchBar.value.toLowerCase(); // Get the search term and convert it to lowercase

        const rows = document.querySelectorAll("#monitor-table tr"); // Get all table rows

        // Iterate through each row, hide non-matching rows and display matching rows
        for (const row of rows) {
          const name = row.cells[0].textContent.toLowerCase(); // Get the monitor name and convert it to lowercase
          if (name.includes(searchTerm)) {
            row.style.display = ""; // Display matching rows
          } else {
            row.style.display = "none"; // Hide non-matching rows
          }
        }
      });
    </script>
  </body>
</html>
